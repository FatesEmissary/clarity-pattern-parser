{"version":3,"sources":["../../../src/patterns/composite/RepeatComposite.js"],"names":["RepeatComposite","name","pattern","divider","_pattern","children","_divider","_assertArguments","OptionalComposite","Error","cursor","nodes","mark","_reset","_tryPattern","node","parse","hasUnresolvedError","_processMatch","push","endIndex","lastIndex","next","moveToMark","resolveError","length","throwError","ParseError","CompositeNode","startIndex","index","addMatch","rootPattern","Pattern","dividerPossibilities","getPossibilities","map","possibility","reduce","acc","value","concat","CompositePattern"],"mappings":"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","sourcesContent":["import CompositePattern from \"./CompositePattern.js\";\nimport CompositeNode from \"../../ast/CompositeNode.js\";\nimport ParseError from \"../ParseError.js\";\nimport OptionalComposite from \"./OptionalComposite.js\";\nimport Pattern from \"../Pattern.js\";\n\nexport default class RepeatComposite extends CompositePattern {\n  constructor(name, pattern, divider) {\n    super(\n      \"repeat-composite\",\n      name,\n      divider != null ? [pattern, divider] : [pattern]\n    );\n    this._pattern = this.children[0];\n    this._divider = this.children[1];\n    this._assertArguments();\n  }\n\n  _assertArguments() {\n    if (this._pattern instanceof OptionalComposite) {\n      throw new Error(\n        \"Invalid Arguments: The pattern cannot be a optional pattern.\"\n      );\n    }\n  }\n\n  _reset(cursor) {\n    this.nodes = [];\n    this.cursor = cursor;\n    this.mark = this.cursor.mark();\n  }\n\n  parse(cursor) {\n    this._reset(cursor);\n    this._tryPattern();\n\n    return this.node;\n  }\n\n  _tryPattern() {\n    while (true) {\n      const node = this._pattern.parse(this.cursor);\n\n      if (this.cursor.hasUnresolvedError()) {\n        this._processMatch();\n        break;\n      } else {\n        this.nodes.push(node);\n\n        if (node.endIndex === this.cursor.lastIndex()) {\n          this._processMatch();\n          break;\n        }\n\n        this.cursor.next();\n\n        if (this._divider != null) {\n          const mark = this.cursor.mark();\n          const node = this._divider.parse(this.cursor);\n\n          if (this.cursor.hasUnresolvedError()) {\n            this.cursor.moveToMark(mark);\n            this._processMatch();\n            break;\n          } else {\n            this.nodes.push(node);\n            this.cursor.next();\n          }\n        }\n      }\n    }\n  }\n\n  _processMatch() {\n    this.cursor.resolveError();\n\n    if (this.nodes.length === 0) {\n      this.cursor.throwError(\n        new ParseError(\n          `Did not find a repeating match of ${this.name}.`,\n          this.mark,\n          this\n        )\n      );\n      this.node = null;\n    } else {\n      this.node = new CompositeNode(\n        \"repeat-composite\",\n        this.name,\n        this.nodes[0].startIndex,\n        this.nodes[this.nodes.length - 1].endIndex\n      );\n\n      this.node.children = this.nodes;\n      this.cursor.index = this.node.endIndex;\n\n      this.cursor.addMatch(this, this.node);\n    }\n  }\n\n  clone(name) {\n    if (typeof name !== \"string\") {\n      name = this.name;\n    }\n    return new RepeatComposite(name, this._pattern, this._divider);\n  }\n\n  getCurrentMark() {\n    return this.mark;\n  }\n\n  getPossibilities(rootPattern) {\n    if (rootPattern == null || !(rootPattern instanceof Pattern)) {\n      rootPattern = this;\n    }\n\n    if (this._divider != null) {\n      const dividerPossibilities = this._divider.getPossibilities(rootPattern);\n\n      return this._pattern\n        .getPossibilities(rootPattern)\n        .map(possibility => {\n          return dividerPossibilities.map(divider => {\n            return `${possibility}${divider}`;\n          });\n        })\n        .reduce((acc, value) => {\n          return acc.concat(value);\n        }, []);\n    } else {\n      return this._pattern.getPossibilities(rootPattern);\n    }\n  }\n}\n"],"file":"RepeatComposite.js"}