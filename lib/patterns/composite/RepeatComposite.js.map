{"version":3,"sources":["../../../src/patterns/composite/RepeatComposite.js"],"names":["RepeatComposite","name","pattern","patterns","assertArguments","reset","Pattern","Error","OptionalComposite","cursor","index","nodes","node","mark","tryPattern","push","parse","error","processValue","length","ParseError","getName","filter","CompositeNode","startIndex","endIndex","children","CompositePattern"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;IAEqBA,e;;;;;AACnB,2BAAYC,IAAZ,EAAkBC,OAAlB,EAA2B;AAAA;;AAAA;;AACzB,UAAKD,IAAL,GAAYA,IAAZ;AACA,UAAKC,OAAL,GAAeA,OAAf;AACA,UAAKC,QAAL,GAAgB,CAACD,OAAD,CAAhB;;AAEA,UAAKE,eAAL;;AACA,UAAKC,KAAL;;AANyB;AAO1B;;;;sCAEiB;AAChB,UAAI,EAAE,KAAKH,OAAL,YAAwBI,OAA1B,CAAJ,EAAwC;AACtC,cAAM,IAAIC,KAAJ,CACJ,mEADI,CAAN;AAGD;;AAED,UAAI,KAAKL,OAAL,YAAwBM,0BAA5B,EAA+C;AAC7C,cAAM,IAAID,KAAJ,CACJ,6EADI,CAAN;AAGD;;AAED,UAAI,OAAO,KAAKN,IAAZ,KAAqB,QAAzB,EAAmC;AACjC,cAAM,IAAIM,KAAJ,CACJ,yEADI,CAAN;AAGD;AACF;;;0BAEKE,M,EAAQ;AACZ,WAAKA,MAAL,GAAc,IAAd;AACA,WAAKC,KAAL,GAAa,CAAb;AACA,WAAKC,KAAL,GAAa,EAAb;AACA,WAAKC,IAAL,GAAY,IAAZ;;AAEA,UAAIH,MAAM,IAAI,IAAd,EAAoB;AAClB,aAAKA,MAAL,GAAcA,MAAd;AACA,aAAKI,IAAL,GAAY,KAAKJ,MAAL,CAAYI,IAAZ,EAAZ;AACD;AACF;;;0BAEKJ,M,EAAQ;AACZ,WAAKJ,KAAL,CAAWI,MAAX;AACA,WAAKK,UAAL;AAEA,aAAO,KAAKF,IAAZ;AACD;;;iCAEY;AACX,aAAO,IAAP,EAAa;AACX,YAAI;AACF,eAAKD,KAAL,CAAWI,IAAX,CAAgB,KAAKb,OAAL,CAAac,KAAb,CAAmB,KAAKP,MAAxB,CAAhB;AACD,SAFD,CAEE,OAAOQ,KAAP,EAAc;AACd;AACD;AACF;;AAED,WAAKC,YAAL;AACD;;;mCAEc;AACb,UAAI,KAAKP,KAAL,CAAWQ,MAAX,KAAsB,CAA1B,EAA6B;AAC3B,cAAM,IAAIC,UAAJ,6BAAoC,KAAKlB,OAAL,CAAamB,OAAb,EAApC,gBAAuE,KAAKR,IAAL,CAAUH,KAAjF,EAAwF,IAAxF,CAAN;AACD;;AAED,WAAKC,KAAL,GAAa,KAAKA,KAAL,CAAWW,MAAX,CAAkB,UAAAV,IAAI;AAAA,eAAIA,IAAI,IAAI,IAAZ;AAAA,OAAtB,CAAb;AACA,WAAKA,IAAL,GAAY,IAAIW,sBAAJ,CACV,KAAKtB,IADK,EAEV,KAAKU,KAAL,CAAW,CAAX,EAAca,UAFJ,EAGV,KAAKb,KAAL,CAAW,KAAKA,KAAL,CAAWQ,MAAX,GAAoB,CAA/B,EAAkCM,QAHxB,CAAZ;AAKA,WAAKb,IAAL,CAAUc,QAAV,GAAqB,KAAKf,KAA1B;AACD;;;kCAEa;AACZ,aAAO,KAAKR,QAAZ;AACD;;;4BAEO;AACN,aAAO,IAAIH,eAAJ,CAAoB,KAAKC,IAAzB,EAA+B,KAAKE,QAApC,CAAP;AACD;;;;EAjF0CwB,0B","sourcesContent":["import CompositePattern from \"./CompositePattern.js\";\nimport CompositeNode from \"../../ast/CompositeNode.js\";\nimport OptionalComposite from \"./OptionalComposite.js\";\n\nexport default class RepeatComposite extends CompositePattern {\n  constructor(name, pattern) {\n    this.name = name;\n    this.pattern = pattern;\n    this.patterns = [pattern];\n    \n    this.assertArguments();\n    this.reset();\n  }\n\n  assertArguments() {\n    if (!(this.pattern instanceof Pattern)) {\n      throw new Error(\n        \"Invalid Argument: The pattern needs to be an instance of Pattern.\"\n      );\n    }\n\n    if (this.pattern instanceof OptionalComposite) {\n      throw new Error(\n        \"Invalid Argument: Cannot use an OptionalComposite within a RepeatComposite.\"\n      );\n    }\n\n    if (typeof this.name !== \"string\") {\n      throw new Error(\n        \"Invalid Argument: RepeatComposite needs to have a name that's a string.\"\n      );\n    }\n  }\n\n  reset(cursor) {\n    this.cursor = null;\n    this.index = 0;\n    this.nodes = [];\n    this.node = null;\n\n    if (cursor != null) {\n      this.cursor = cursor;\n      this.mark = this.cursor.mark();\n    }\n  }\n\n  parse(cursor) {\n    this.reset(cursor);\n    this.tryPattern();\n\n    return this.node;\n  }\n\n  tryPattern() {\n    while (true) {\n      try {\n        this.nodes.push(this.pattern.parse(this.cursor));\n      } catch (error) {\n        break;\n      }\n    }\n\n    this.processValue();\n  }\n\n  processValue() {\n    if (this.nodes.length === 0) {\n      throw new ParseError(`Couldn't find the ${this.pattern.getName()} pattern.`, this.mark.index, this);\n    }\n\n    this.nodes = this.nodes.filter(node => node != null);\n    this.node = new CompositeNode(\n      this.name,\n      this.nodes[0].startIndex,\n      this.nodes[this.nodes.length - 1].endIndex\n    );\n    this.node.children = this.nodes;\n  }\n\n  getPatterns() {\n    return this.patterns;\n  }\n\n  clone() {\n    return new RepeatComposite(this.name, this.patterns);\n  }\n}\n"],"file":"RepeatComposite.js"}