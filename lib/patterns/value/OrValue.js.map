{"version":3,"sources":["../../../src/patterns/value/OrValue.js"],"names":["OrValue","name","patterns","reset","cursor","mark","index","errors","node","assertCursor","tryPattern","Cursor","Error","pattern","parse","ParserError","ValueNode","value","startIndex","endIndex","error","push","length","moveToMark","throwError","reduce","furthestError","nextError","stack","ValuePatterns"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;IAEqBA,O;;;;;AACnB,mBAAYC,IAAZ,EAAkBC,QAAlB,EAA4B;AAAA;;AAAA;;AAC1B,iFAAMD,IAAN,EAAYC,QAAZ;;AACA,UAAKC,KAAL;;AAF0B;AAG3B;;;;0BAEKC,M,EAAQ;AACZ,WAAKA,MAAL,GAAc,IAAd;AACA,WAAKC,IAAL,GAAY,IAAZ;AACA,WAAKC,KAAL,GAAa,CAAb;AACA,WAAKC,MAAL,GAAc,EAAd;AACA,WAAKC,IAAL,GAAY,IAAZ;;AAEA,UAAIJ,MAAM,IAAI,IAAd,EAAoB;AAClB,aAAKA,MAAL,GAAcA,MAAd;AACA,aAAKC,IAAL,GAAYD,MAAM,CAACC,IAAP,EAAZ;AACD;AACF;;;0BAEKD,M,EAAQ;AACZ,WAAKD,KAAL,CAAWC,MAAX;AACA,WAAKK,YAAL;AACA,WAAKC,UAAL;AAEA,aAAO,KAAKF,IAAZ;AACD;;;mCAEc;AACb,UAAI,EAAE,KAAKJ,MAAL,YAAuBO,eAAzB,CAAJ,EAAsC;AACpC,cAAM,IAAIC,KAAJ,CAAU,uCAAV,CAAN;AACD;AACF;;;iCAEY;AACX,aAAO,IAAP,EAAa;AACX,YAAMC,OAAO,GAAG,KAAKX,QAAL,CAAc,KAAKI,KAAnB,CAAhB;;AAEA,YAAI;AACF,cAAME,IAAI,GAAIK,OAAO,CAACC,KAAR,CAAc,KAAKV,MAAnB,CAAd;;AAEA,cAAII,IAAI,IAAI,IAAZ,EAAkB;AAChB,kBAAM,IAAIO,WAAJ,CACJ,iCADI,EAEJ,KAAKV,IAAL,CAAUC,KAFN,EAGJ,IAHI,CAAN;AAKD;;AAED,eAAKE,IAAL,GAAY,IAAIQ,kBAAJ,CAAc,KAAKf,IAAnB,EAAyBO,IAAI,CAACS,KAA9B,EAAqCT,IAAI,CAACU,UAA1C,EAAsDV,IAAI,CAACW,QAA3D,CAAZ;AACA;AACD,SAbD,CAaE,OAAOC,KAAP,EAAc;AACd,eAAKb,MAAL,CAAYc,IAAZ,CAAiBD,KAAjB;;AAEA,cAAI,KAAKd,KAAL,GAAa,CAAb,GAAiB,KAAKJ,QAAL,CAAcoB,MAAnC,EAA2C;AACzC,iBAAKhB,KAAL;AACA,iBAAKF,MAAL,CAAYmB,UAAZ,CAAuB,KAAKlB,IAA5B;AACD,WAHD,MAGO;AACL,iBAAKmB,UAAL;AACD;AACF;AACF;AACF;;;iCAEY;AACX,UAAMJ,KAAK,GAAG,KAAKb,MAAL,CAAYkB,MAAZ,CAAmB,UAACC,aAAD,EAAgBC,SAAhB,EAA8B;AAC7D,YAAID,aAAa,CAACpB,KAAd,GAAsBqB,SAAS,CAACrB,KAApC,EAA2C;AACzC,iBAAOoB,aAAP;AACD,SAFD,MAEO;AACL,iBAAOC,SAAP;AACD;AACF,OANa,CAAd;AAQAP,MAAAA,KAAK,CAACQ,KAAN,CAAYP,IAAZ,CAAiB,KAAKhB,IAAtB,EAA4B,IAA5B;AAEA,YAAMe,KAAN;AACD;;;4BAEO;AACN,aAAO,IAAIpB,OAAJ,CAAY,KAAKC,IAAjB,EAAuB,KAAKC,QAA5B,CAAP;AACD;;;;EA/EkC2B,uB","sourcesContent":["import ValuePatterns from \"./ValuePatterns.js\";\nimport ValueNode from \"../../ast/ValueNode.js\";\nimport Cursor from \"../../Cursor.js\";\n\nexport default class OrValue extends ValuePatterns {\n  constructor(name, patterns) {\n    super(name, patterns);\n    this.reset();\n  }\n\n  reset(cursor) {\n    this.cursor = null;\n    this.mark = null;\n    this.index = 0;\n    this.errors = [];\n    this.node = null;\n\n    if (cursor != null) {\n      this.cursor = cursor;\n      this.mark = cursor.mark();\n    }\n  }\n\n  parse(cursor) {\n    this.reset(cursor);\n    this.assertCursor();\n    this.tryPattern();\n\n    return this.node;\n  }\n\n  assertCursor() {\n    if (!(this.cursor instanceof Cursor)) {\n      throw new Error(\"Invalid Arguments: Expected a cursor.\");\n    }\n  }\n\n  tryPattern() {\n    while (true) {\n      const pattern = this.patterns[this.index];\n\n      try {\n        const node  = pattern.parse(this.cursor);\n\n        if (node == null) {\n          throw new ParserError(\n            \"Optional pattern did not match.\",\n            this.mark.index,\n            this\n          );\n        }\n\n        this.node = new ValueNode(this.name, node.value, node.startIndex, node.endIndex);\n        break;\n      } catch (error) {\n        this.errors.push(error);\n\n        if (this.index + 1 < this.patterns.length) {\n          this.index++;\n          this.cursor.moveToMark(this.mark);\n        } else {\n          this.throwError();\n        }\n      }\n    }\n  }\n\n  throwError() {\n    const error = this.errors.reduce((furthestError, nextError) => {\n      if (furthestError.index > nextError.index) {\n        return furthestError;\n      } else {\n        return nextError;\n      }\n    });\n\n    error.stack.push(this.mark, this);\n\n    throw error;\n  }\n\n  clone() {\n    return new OrValue(this.name, this.patterns);\n  }\n}\n"],"file":"OrValue.js"}