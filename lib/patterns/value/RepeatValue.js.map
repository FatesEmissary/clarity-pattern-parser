{"version":3,"sources":["../../../src/patterns/value/RepeatValue.js"],"names":["RepeatValue","ValuePattern","constructor","name","pattern","clone","patterns","assertArguments","reset","Error","cursor","mark","nodes","parse","tryPattern","node","push","error","processMatch","moveToMark","length","ParseError","value","map","join","ValueNode","startIndex","endIndex","getName","getPatterns","getValue"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;AAEe,MAAMA,WAAN,SAA0BC,qBAA1B,CAAuC;AACpDC,EAAAA,WAAW,CAACC,IAAD,EAAOC,OAAP,EAAgB;AACzB;AACA,SAAKD,IAAL,GAAYA,IAAZ;AACA,SAAKC,OAAL,GAAeA,OAAO,CAACC,KAAR,EAAf;AACA,SAAKC,QAAL,GAAgB,CAACF,OAAD,CAAhB;AAEA,SAAKG,eAAL;AACA,SAAKC,KAAL;AACD;;AAEDD,EAAAA,eAAe,GAAG;AAChB,QAAI,EAAE,KAAKH,OAAL,YAAwBH,qBAA1B,CAAJ,EAA6C;AAC3C,YAAM,IAAIQ,KAAJ,CACJ,+DADI,CAAN;AAGD;;AAED,QAAI,OAAO,KAAKN,IAAZ,KAAqB,QAAzB,EAAmC;AACjC,YAAM,IAAIM,KAAJ,CAAU,kDAAV,CAAN;AACD;AACF;;AAEDD,EAAAA,KAAK,CAACE,MAAD,EAAS;AACZ,SAAKA,MAAL,GAAc,IAAd;AACA,SAAKC,IAAL,GAAY,IAAZ;AACA,SAAKC,KAAL,GAAa,EAAb;;AAEA,QAAIF,MAAM,IAAI,IAAd,EAAoB;AAClB,WAAKA,MAAL,GAAcA,MAAd;AACA,WAAKC,IAAL,GAAY,KAAKD,MAAL,CAAYC,IAAZ,EAAZ;AACD;AACF;;AAEDE,EAAAA,KAAK,CAACH,MAAD,EAAS;AACZ,SAAKF,KAAL,CAAWE,MAAX;AACA,SAAKI,UAAL;AAEA,WAAO,KAAKC,IAAZ;AACD;;AAEDD,EAAAA,UAAU,GAAG;AACX,WAAO,IAAP,EAAa;AACX,YAAMH,IAAI,GAAG,KAAKD,MAAL,CAAYC,IAAZ,EAAb;;AAEA,UAAI;AACF,aAAKC,KAAL,CAAWI,IAAX,CAAgB,KAAKZ,OAAL,CAAaS,KAAb,CAAmB,KAAKH,MAAxB,CAAhB;AACD,OAFD,CAEE,OAAOO,KAAP,EAAc;AACd,aAAKC,YAAL;AACA,aAAKR,MAAL,CAAYS,UAAZ,CAAuBR,IAAvB;AACA;AACD;AACF;AACF;;AAEDO,EAAAA,YAAY,GAAG;AACb,QAAI,KAAKN,KAAL,CAAWQ,MAAX,KAAsB,CAA1B,EAA6B;AAC3B,YAAM,IAAIC,mBAAJ,CAAgB,EAAhB,CAAN;AACD,KAFD,MAEO;AACL,YAAMC,KAAK,GAAG,KAAKV,KAAL,CAAWW,GAAX,CAAeR,IAAI,IAAIA,IAAI,CAACO,KAA5B,EAAmCE,IAAnC,CAAwC,EAAxC,CAAd;AAEA,WAAKT,IAAL,GAAY,IAAIU,kBAAJ,CACV,KAAKtB,IADK,EAEVmB,KAFU,EAGV,KAAKV,KAAL,CAAW,CAAX,EAAcc,UAHJ,EAIV,KAAKd,KAAL,CAAW,KAAKA,KAAL,CAAWQ,MAAX,GAAoB,CAA/B,EAAkCO,QAJxB,CAAZ;AAMD;AACF;;AAEDC,EAAAA,OAAO,GAAG;AACR,WAAO,KAAKzB,IAAZ;AACD;;AAED0B,EAAAA,WAAW,GAAG;AACZ,WAAO,KAAKvB,QAAZ;AACD;;AAEDwB,EAAAA,QAAQ,GAAG;AACT,WAAO,IAAP;AACD;;AAEDzB,EAAAA,KAAK,GAAG;AACN,WAAO,IAAIL,WAAJ,CAAgB,KAAKG,IAArB,EAA2B,KAAKC,OAAhC,CAAP;AACD;;AApFmD","sourcesContent":["import ValuePattern from \"./ValuePattern.js\";\nimport ValueNode from \"../../ast/ValueNode\";\nimport ParseError from \"../ParseError.js\";\n\nexport default class RepeatValue extends ValuePattern {\n  constructor(name, pattern) {\n    super();\n    this.name = name;\n    this.pattern = pattern.clone();\n    this.patterns = [pattern];\n\n    this.assertArguments();\n    this.reset();\n  }\n\n  assertArguments() {\n    if (!(this.pattern instanceof ValuePattern)) {\n      throw new Error(\n        \"Invalid Arguments: Expected the pattern to be a ValuePattern.\"\n      );\n    }\n\n    if (typeof this.name !== \"string\") {\n      throw new Error(\"Invalid Arguments: Expected name to be a string.\");\n    }\n  }\n\n  reset(cursor) {\n    this.cursor = null;\n    this.mark = null;\n    this.nodes = [];\n\n    if (cursor != null) {\n      this.cursor = cursor;\n      this.mark = this.cursor.mark();\n    }\n  }\n\n  parse(cursor) {\n    this.reset(cursor);\n    this.tryPattern();\n\n    return this.node;\n  }\n\n  tryPattern() {\n    while (true) {\n      const mark = this.cursor.mark();\n\n      try {\n        this.nodes.push(this.pattern.parse(this.cursor));\n      } catch (error) {\n        this.processMatch();\n        this.cursor.moveToMark(mark);\n        break;\n      }\n    }\n  }\n\n  processMatch() {\n    if (this.nodes.length === 0) {\n      throw new ParseError(``);\n    } else {\n      const value = this.nodes.map(node => node.value).join(\"\");\n\n      this.node = new ValueNode(\n        this.name,\n        value,\n        this.nodes[0].startIndex,\n        this.nodes[this.nodes.length - 1].endIndex\n      );\n    }\n  }\n\n  getName() {\n    return this.name;\n  }\n\n  getPatterns() {\n    return this.patterns;\n  }\n\n  getValue() {\n    return null;\n  }\n\n  clone() {\n    return new RepeatValue(this.name, this.pattern);\n  }\n}\n"],"file":"RepeatValue.js"}